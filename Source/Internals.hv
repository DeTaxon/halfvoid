TemplateInternalInitClass := BoxFuncTemplate^
//TemplateInternalVirtualCall := BoxFuncTemplate^
TemplateInternalNewOne := BoxFuncTemplate^
TemplateInternalNewOneConstructed := BoxFuncTemplate^
FunctionInternalDelete := BoxFunc^

TemplateInternalCreateLambda := BoxFuncTemplate^
TemplateInternalLambdaCall := BoxFuncTemplate^

TemplateInternalCreateTuple := BoxFuncTemplate^
TemplateInternalTupleConstructor := BoxFuncTemplate^

TemplateInternalGetVTableVariable := BoxFuncTemplate^

TemplateInternalIsInSameType := BoxFuncTemplate^

GInternalSetType := BoxFuncTemplate^

GFuncGCSetNull := BoxFunc^

GCType := Type^

GCILambda := BoxClass^
GCLambda := BoxClassTemplate^

GCStackType := BoxClassTemplate^
GCDeferLambda := BoxClassTemplate^

ArrayViewTemplate := BoxClassTemplate^
ArrayViewCreateEmptyArray := BoxFuncTemplate^

GDefautlSetTemplate := BoxFuncTemplate^
GDefautlCompareTemplate := BoxFuncTemplate^

GZeroMemTemplate := BoxFuncTemplate^

GVectorConstructor1 := BoxFuncTemplate^
GVectorConstructor2 := BoxFuncTemplate^
GVectorConstructor3 := BoxFuncTemplate^
GVectorConstructor4 := BoxFuncTemplate^

InternalsHatch := THatch

intGetTemplate := !(char^ name) -> BoxFuncTemplate^
{
	res := BoxFuncTemplate^
	GetItemGlobal(StringSpan(name),x ==> {
		for itm : x
		{
			if itm is in BoxFuncTemplate
			{
				res = itm->{BoxFuncTemplate^}
				return true
			}
		}
	})
	assert(res != null)
	return res
}
intGetFunc := !(char^ name) -> BoxFunc^
{
	res := intGetTemplate(name)
	assert(res.IsOneFunc())
	return res.GetOneFunc()
}

intGetClass := !(char^ name) -> BoxClass^
{
	res := GetTypeByName(StringSpan(name))
	assert(res != null)
	assert(res is in TypeClass)
	return res->{TypeClass^}.ToClass
}

intGetClassTemplate := !(char^ name) -> BoxClassTemplate^
{
	res := GetTypeObjByName(StringSpan(name))
	assert(res != null)
	assert(res is in TemplateTypeVar)
	return res->{TemplateTypeVar^}.Value
}

InitInternals := !() -> void
{
	//TracyZone("Internal functions")

	TemplateInternalInitClass = intGetTemplate("internalHVInitClass")
	//TemplateInternalVirtualCall = intGetTemplate("internalHVVirtualMethodCall")
	TemplateInternalNewOne = intGetTemplate("internalHVNew")
	TemplateInternalNewOneConstructed = intGetTemplate("internalHVNewConstructed")
	FunctionInternalDelete = intGetFunc("internalHVDelete")

	TemplateInternalCreateLambda = intGetTemplate("internalHVCreateLambda")
	TemplateInternalLambdaCall = intGetTemplate("internalHVLambdaCall")

	TemplateInternalCreateTuple = intGetTemplate("internalHVCreateTuple")
	TemplateInternalTupleConstructor = intGetTemplate("internalTupleConstructor")

	TemplateInternalGetVTableVariable = intGetTemplate("internalGetVTableVariable")

	TemplateInternalIsInSameType = intGetTemplate("internalCheckIsInSameType")

	GFuncGCSetNull = intGetFunc("internalHVGCSetNull")

	GInternalSetType = intGetTemplate("internalHVSetType")

	cName := TokenIndent(StringSpan("TGCObject"))
	//GCType = ParseType(cName&)

	GCILambda = intGetClass("TILambda")
	GCLambda = intGetClassTemplate("TLambda")

	GCStackType = intGetClassTemplate("internalHVStackAllocatedGC")
	GCDeferLambda = intGetClassTemplate("internalHVDeferLambda")

	ArrayViewTemplate = intGetClassTemplate("TArrayView")
	ArrayViewCreateEmptyArray = intGetTemplate("internalCreateEmptyArray")

	GZeroMemTemplate = intGetTemplate("ZeroMem")

	GDefautlSetTemplate = intGetTemplate("internalClassDefaultSet")
	GDefautlCompareTemplate = intGetTemplate("internalClassDefaultCompare")

	GVectorConstructor1 = intGetTemplate("internalVectorConstructor1")
	GVectorConstructor2 = intGetTemplate("internalVectorConstructor2")
	GVectorConstructor3 = intGetTemplate("internalVectorConstructor3")
	GVectorConstructor4 = intGetTemplate("internalVectorConstructor4")

	InternalsHatch.Emit()
}
