
gTaskIORing := void^
gTaskRingWorkCount := int

TaskDoUring := !( !(void^)&->void cb) -> void
{
	gTaskRingWorkCount += 1

	sqe := ur_get_sqe(gTaskIORing)
	cb(sqe)
	ur_sqe_set_data(sqe,CurrentTask)
	ur_submit(gTaskIORing)
	
	CurrentTask.IncRef()
	CurrentThread.ThreadMainTask.switchToTask()
	CurrentTask.DecRef()
	
	gTaskRingWorkCount -= 1
}
